<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Undangan Pernikahan</title>

<style>
:root{--gold:#d4af37}
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(180deg,#fff,#f7f4ec);
  text-align:center;
}
.loader{
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:18px;
  color:var(--gold);
}
main{max-width:720px;margin:auto;padding:20px}
.hero h1{color:var(--gold);font-size:36px;margin-bottom:5px}
.section{
  background:#fff;
  margin:20px 0;
  padding:25px;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}
#map-frame-container iframe{
  width:100%;
  height:280px;
  border:none;
  border-radius:12px;
  margin-top:10px;
}
.gallery-slider{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:12px;
  margin-top:15px;
}
.gallery-slider img{
  width:100%;
  border-radius:12px;
  object-fit:cover;
}
#whatsapp-btn{
  display:inline-block;
  margin:25px 0 40px;
  padding:14px 26px;
  background:#25d366;
  color:#fff;
  text-decoration:none;
  border-radius:30px;
  font-weight:600;
}
</style>
</head>

<body>

<div id="loader" class="loader">Memuat undangan...</div>

<main id="content" style="display:none">
  <section class="hero">
    <h1 id="couple-name"></h1>
    <p id="event-date"></p>
  </section>

  <section class="section">
    <h3>Lokasi Acara</h3>
    <p id="event-location"></p>
    <div id="map-frame-container"></div>
  </section>

  <section class="section">
    <h3>Galeri</h3>
    <div id="gallery-slider" class="gallery-slider"></div>
  </section>

  <a id="whatsapp-btn" target="_blank">Konfirmasi Kehadiran</a>
</main>

<script>
/* =============================
   CONFIG
============================= */
const IMAGE_BASE =
  "https://xl4as.github.io/invit/images/";

/* =============================
   LOAD DATA ?id=
============================= */
const loader  = document.getElementById("loader");
const content = document.getElementById("content");

const id = new URLSearchParams(location.search).get("id");

if(!id){
  loader.innerHTML = "ID undangan tidak ada di URL";
  throw new Error("Missing ID");
}

const DATA_URL =
  `https://raw.githubusercontent.com/XL4AS/invit/main/data/${id}_invitation.json`;

fetch(DATA_URL,{cache:"no-store"})
  .then(r=>{
    if(!r.ok) throw new Error("JSON tidak ditemukan");
    return r.json();
  })
  .then(renderData)
  .catch(err=>{
    console.error(err);
    loader.innerHTML = `Data undangan <b>${id}</b> tidak ditemukan`;
  });

/* =============================
   RENDER DATA
============================= */
function renderData(data){

  document.getElementById("couple-name").textContent =
    `${data.groom} & ${data.bride}`;

  document.getElementById("event-date").textContent =
    new Date(data.date+"T00:00:00").toLocaleDateString("id-ID",{
      weekday:"long",
      day:"numeric",
      month:"long",
      year:"numeric"
    });

  document.getElementById("event-location").textContent =
    data.location || "";

  /* MAP */
  document.getElementById("map-frame-container").innerHTML =
    data.maps && data.maps.includes("embed")
    ? `<iframe src="${data.maps}" loading="lazy"></iframe>`
    : "<p>Peta tidak tersedia</p>";

  /* GALERI (NAMA FILE SAJA) */
  const gallery = document.getElementById("gallery-slider");
  gallery.innerHTML = "";

  if(Array.isArray(data.gallery)){
    data.gallery.forEach(name=>{
      const img = new Image();
      img.src = IMAGE_BASE + name;
      img.loading = "lazy";
      img.onerror = ()=>img.remove();
      gallery.appendChild(img);
    });
  }

  /* WHATSAPP */
  document.getElementById("whatsapp-btn").href =
    `https://wa.me/${data.phone}?text=Saya%20akan%20hadir`;

  loader.style.display="none";
  content.style.display="block";
}
</script>

</body>
</html>
